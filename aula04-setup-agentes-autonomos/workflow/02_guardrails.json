{
  "name": "A04 - Etapa 2 - Guardrails (Regex + Rota Revisão)",
  "nodes": [
    {
      "id": "1",
      "name": "Form Input",
      "type": "n8n-nodes-base.formTrigger",
      "parameters": {
        "fields": [
          "nome",
          "email",
          "descricao"
        ]
      }
    },
    {
      "id": "2",
      "name": "Validar Email (Regex)",
      "type": "n8n-nodes-base.if",
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json[\"email\"]}}",
              "operation": "regex",
              "value2": "^[\\w\\.-]+@[\\w\\.-]+\\.\\w+$"
            }
          ]
        }
      }
    },
    {
      "id": "3",
      "name": "Gemini - Validar Estrutura",
      "type": "n8n-nodes-base.httpRequest",
      "parameters": {
        "url": "https://api.gemini.fake/validate",
        "method": "POST",
        "json": true,
        "body": {
          "system": "Você é um agente de validação. Responda APENAS JSON.",
          "prompt": "Verifique se os campos nome, email e descricao estão corretos. Retorne {\"status\":\"valido|invalido\",\"motivo\":\"...\"}.",
          "input": {
            "nome": "={{$json[\"nome\"]}}",
            "email": "={{$json[\"email\"]}}",
            "descricao": "={{$json[\"descricao\"]}}"
          }
        }
      }
    },
    {
      "id": "4",
      "name": "Decisão",
      "type": "n8n-nodes-base.switch",
      "parameters": {
        "rules": [
          {
            "operation": "equal",
            "value": "valido",
            "input": "={{$json[\"status\"]}}"
          }
        ]
      }
    },
    {
      "id": "5",
      "name": "Salvar no Banco",
      "type": "n8n-nodes-base.mySql",
      "parameters": {
        "query": "INSERT INTO pedidos (nome,email,descricao) VALUES (:nome,:email,:descricao)"
      }
    },
    {
      "id": "6",
      "name": "Revisão Humana",
      "type": "n8n-nodes-base.emailSend",
      "parameters": {
        "to": "revisao@empresa.com",
        "subject": "Pedido inválido",
        "text": "Favor revisar."
      }
    }
  ],
  "connections": {
    "1": {
      "main": [
        [
          "2"
        ]
      ]
    },
    "2": {
      "main": [
        [
          "3"
        ],
        [
          "6"
        ]
      ]
    },
    "3": {
      "main": [
        [
          "4"
        ]
      ]
    },
    "4": {
      "main": [
        [
          "5"
        ],
        [
          "6"
        ]
      ]
    }
  }
}